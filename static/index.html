<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="css/bootstrap.css" />
    <link rel="stylesheet" href="css/message.css" />
    <link rel="stylesheet" href="./css/style.css" />
    <script src="./js/jquery.js"></script>
    <script src="./js/message.js"></script>
    <title>BW的CK自助登录提交</title>
  </head>

  <body>
    <div class="content text-center">
      <div class="header">
        <h3>BW的CK自助登录提交</h3>
      </div>
      <div class="alert alert-primary" role="alert" id="info"><h1 style=\"color:red;\">为了您的财产安全，请关闭京东免密支付！<\/h1><p style=\"color:#ffb120;\">（京东-设置-支付设置-支付验证设置）<\/p><p style=\"color:#18ff44;\"><\/p><p style=\"color:#8000短信登录须知！！！<\/p> <p style=\"color:#008080;\">机器人QQ：109629272<\/p> <p style=\"color:#4169E1;\">0;\登录后点击[获取cookie]然后[提交]或者复制发送给机器人。<\/p><p><a style=\"    display: block;     text-decoration: none;     background: #4080ff;     color: #f9f9f9;     padding: 12px;     border: none;     border-radius: 25px;     margin-top: 30px;     font-size: 16px;     font-weight: 700;     min-width: 200px;     transition: 0.2s;\" href=\"http://wpa.qq.com/msgrd?v=3&uin=109629272&site=qq&menu=yes\" target=\"_blank\" >点击添加机器人<\/a><\/p><p style=\"color:#F08080;\">机器人添加后发送[查询]来查看个人信息<\/p></div>
      <form class="myForm">
        <div class="form-group">
          <label for="phone" class="text-left">手机号:</label>
          <input
            type="text"
            class="form-control"
            id="phone"
            aria-describedby="emailHelp"
            name="id"
          />
        </div>
        <div class="form-group">
          <label for="code" class="text-left">验证码:</label>
          <input type="text" class="form-control" id="code" name="key" />
		  <input
            type="button"
            value="获取验证码"
            onclick="sendSms()"
            class="btn btn-primary margin-top-bottom text-center"
          />
          <input
            type="button"
            value="获取cookie"
            onclick="verifyCode()"
            class="btn btn-primary margin-top-bottom"
          />
        </div>
        <div class="form-group">
          <label for="cookie" class="text-left">cookie:</label>
          <input type="text" class="form-control" id="cookie" name="url" />
          <input
            type="button"
            value="提交cookie"
            onclick="submitCookie()"
            class="btn btn-success margin-top-bottom"
          />
        </div>
      </form>
    </div>
  </body>
  <script type="text/javascript">
    var obj;

    function sendSms() {
      $.get("../sendSms?phone=" + $("#phone").val(), (data) => {
        if (data.ok) {
          $.message({
            message: "验证码发送成功",
          });
        } else {
          $.message({
            type: "error",
            message: data.msg,
          });
        }
        obj = data.data;
      });
    }

    function verifyCode() {
      if (!obj) {
        $.message({
          type: "error",
          message: "请先发送验证码",
        });
      }
      $.ajax({
        type: "POST",
        url:
          "../checkCode?phone=" +
          $("#phone").val() +
          "&code=" +
          $("#code").val(),
        data: JSON.stringify(obj),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
      }).then((data) => {
        if (data.ok) {
          $.message({
            message: "获取cookie成功",
          });
          $("#cookie").val(data.data.ck);
        } else {
          $.message({
            type: "error",
            message: data.msg,
          });
        }
      });
    }

    function submitCookie() {
      $.ajax({
        type: "POST",
        url: "../submitCk",
        data: JSON.stringify({ ck: $("#cookie").val() }),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
      }).then((data) => {
        $.message({
          type: data.ok ? "success" : "error",
          message: data.msg,
        });
      });
    }
  </script>
</html>
